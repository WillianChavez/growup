// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String
  password  String
  timezone  String   @default("America/New_York")
  currency  String   @default("USD")
  theme     String   @default("light")
  settings  String?  // JSON string for additional settings
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  habits                Habit[]
  habitCategories       HabitCategory[]
  habitEntries          HabitEntry[]
  books                 Book[]
  bookQuotes            BookQuote[]
  transactions          Transaction[]
  transactionCategories TransactionCategory[]
  budgets               Budget[]
  incomeSources         IncomeSource[]
  recurringExpenses     RecurringExpense[]
  assets                Asset[]
  debts                 Debt[]
  goals                 Goal[]
  journals              DailyJournal[]
}

model Habit {
  id          String   @id @default(uuid())
  userId      String
  title       String
  description String?
  emoji       String   @default("üéØ")
  categoryId  String
  isActive    Boolean  @default(true)
  isArchived  Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user     User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  category HabitCategory @relation(fields: [categoryId], references: [id])
  entries  HabitEntry[]

  @@index([userId])
  @@index([categoryId])
}

model HabitCategory {
  id        String   @id @default(uuid())
  userId    String
  name      String
  emoji     String   @default("üìÅ")
  color     String   @default("#3b82f6")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  habits Habit[]

  @@index([userId])
}

model HabitEntry {
  id          String   @id @default(uuid())
  habitId     String
  userId      String
  date        DateTime // Date of the entry
  completed   Boolean  @default(false)
  notes       String?
  completedAt DateTime?
  createdAt   DateTime @default(now())

  habit Habit @relation(fields: [habitId], references: [id], onDelete: Cascade)
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([habitId, date])
  @@index([userId, date])
}

model Book {
  id          String    @id @default(uuid())
  userId      String
  title       String
  author      String
  pages       Int       @default(0)
  currentPage Int       @default(0)
  isbn        String?
  coverUrl    String?
  status      String    // reading, completed, to-read, abandoned
  rating      Int?      // 1-5
  review      String?
  notes       String?
  startDate   DateTime?
  endDate     DateTime?
  genre       String?
  tags        String?   // JSON array
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  user   User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  quotes BookQuote[]

  @@index([userId, status])
}

model BookQuote {
  id         String   @id @default(uuid())
  bookId     String
  userId     String
  quote      String
  pageNumber Int?
  isFavorite Boolean  @default(false)
  createdAt  DateTime @default(now())

  book Book @relation(fields: [bookId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([bookId])
}

model Transaction {
  id                  String   @id @default(uuid())
  userId              String
  amount              Float
  type                String   // income, expense
  categoryId          String
  description         String
  notes               String?
  date                DateTime
  isRecurring         Boolean  @default(false)
  recurringFrequency  String?  // monthly, weekly, yearly
  tags                String?  // JSON array
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  user     User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  category TransactionCategory  @relation(fields: [categoryId], references: [id])

  @@index([userId, date])
  @@index([userId, type, categoryId])
}

model TransactionCategory {
  id        String   @id @default(uuid())
  userId    String
  name      String
  emoji     String   @default("üí∞")
  type      String   // income, expense, both
  color     String   @default("#94a3b8")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions Transaction[]

  @@index([userId, type])
}

model Budget {
  id             String   @id @default(uuid())
  userId         String
  category       String
  amount         Float
  period         String   // monthly, yearly
  alertThreshold Int      @default(80) // Percentage
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, category, period])
  @@index([userId])
}

model IncomeSource {
  id          String   @id @default(uuid())
  userId      String
  name        String
  amount      Float
  frequency   String   // monthly, biweekly, weekly, annual
  category    String   @default("salary") // salary, freelance, business, investment, rental, other
  isPrimary   Boolean  @default(false)
  description String?
  isActive    Boolean  @default(true)
  startDate   DateTime @default(now())
  endDate     DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model RecurringExpense {
  id           String   @id @default(uuid())
  userId       String
  name         String
  amount       Float
  frequency    String   // monthly, biweekly, weekly, annual
  category     String   @default("utilities") // utilities, subscriptions, transportation, groceries, health, rent, education, entertainment, other
  dueDay       Int?     // D√≠a del mes (1-31) o de la semana (1-7)
  description  String?
  isActive     Boolean  @default(true)
  isEssential  Boolean  @default(true) // Para clasificar gastos esenciales vs no esenciales
  startDate    DateTime @default(now())
  endDate      DateTime?
  lastPaid     DateTime?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, isActive])
}

model Asset {
  id          String   @id @default(uuid())
  userId      String
  name        String
  value       Float    // Valor de mercado actual
  type        String   // liquid, illiquid
  category    String   // cash, investment, property, vehicle, other
  description String?
  isActive    Boolean  @default(true)
  purchaseDate DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, type])
}

model Debt {
  id               String   @id @default(uuid())
  userId           String
  creditor         String   // A qui√©n le debe
  totalAmount      Float    // Monto total de la deuda
  remainingAmount  Float    // Monto restante por pagar
  monthlyPayment   Float    // Pago mensual
  annualRate       Float    // Tasa de inter√©s anual (%)
  type             String   // consumption, housing, education, vehicle, other
  description      String?
  status           String   @default("active") // active, paid
  startDate        DateTime
  endDate          DateTime? // Fecha estimada de finalizaci√≥n
  paidDate         DateTime? // Fecha en que se pag√≥ completamente
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, status])
}

model Goal {
  id          String    @id @default(uuid())
  userId      String
  title       String
  description String?
  category    String    // personal, professional, health, financial, etc.
  priority    String    @default("medium") // low, medium, high
  status      String    @default("not-started") // not-started, in-progress, completed, abandoned
  targetDate  DateTime?
  progress    Int       @default(0) // 0-100
  milestones  String?   // JSON array
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  completedAt DateTime?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, status])
}

model DailyJournal {
  id           String   @id @default(uuid())
  userId       String
  date         DateTime @unique
  mood         Int?     // 1-10
  gratitude    String?
  achievements String?
  challenges   String?
  notes        String?
  createdAt    DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, date])
}

